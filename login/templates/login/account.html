{% extends 'Nav.html'%}
{% load static %}
{% block css %}<link rel="stylesheet" href="{% static 'login/account.css' %}">{% endblock%}
{% block start %}

<div class="container mt-5">
    <div class="row g-4">
<!-- -----------------------------Left main div---------------------------------- -->
        <div class="col-lg-8">
            <div class="glass-card p-4 h-100">
<!-- -----------------------------Account Details-------------------------------- -->
                <h1 class="display-6 border-bottom pb-2">Account Details</h1>
                <div class="mt-4">
                    <p class="h5"><strong>Account No:</strong> {{user}}</p>
                    <p class="h5"><strong>Holder:</strong> {{user.first_name}}</p>
                    <p class="h5"><strong>Mobile:</strong> {{detail.Mobile_no}}</p>
                    <p class="h5"><strong>Status:</strong>
                        <span class="badge {% if detail.status %}bg-success{% else %}bg-danger{% endif %}">
                            {% if detail.status %}Active{% else %}Closed{% endif %}
                        </span>
                    </p>
                </div>

<!-- -----------------------------Row for buttons-------------------------------- -->
                <div class="row mt-4 p-3 ps-1 border-top">

<!-- --------------------------------------Transfer money---------------------- -->
                    <a href="{% url 'LoginApp:transfer' %}" class="card-link col-lg-4 mb-2 text-decoration-none">
                        <div class="glass-btn-card text-center p-3">
                            <i class="fa-solid fa-building-columns"></i><br>
                            <span class="fw-bold">Transfer</span>
                        </div>
                    </a>

<!-- --------------------------------------Your Statement-------------------------- -->
                    <a href="{% url 'LoginApp:statement' %}?t=True"
                        class="card-link col-lg-4 mb-2 text-decoration-none">
                        <div class="glass-btn-card text-center p-3">
                            <i class="fa-solid fa-file-invoice"></i><br>
                            <span class="fw-bold">Full Statement</span>
                        </div>
                    </a>

<!-- --------------------------------------Check Balance-------------------------- -->
                    {% if request.session.show_balance %}
                    <div class="card-link col-lg-4 mb-2">
                        <div class="glass-btn-card p-3 text-center row justify-content-between">
                            <div class="col-8">
                                Total Balance: <br><span class="fw-bold">₹{{ detail.balance }}</span></div>
                            <div class="border-start col-2 text-center" id="close">
                                <i class="fa-solid fa-circle-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'LoginApp:check_balance' %}" id="check"
                        class="card-link col-lg-4 mb-2 text-decoration-none">
                        <div class="glass-btn-card text-center p-3">
                            <i class="fa-solid fa-money-bill-wave"></i>
                            <br>
                            <span class="fw-bold">Check balance</span>
                        </div>
                    </a>
                    {% endif %}

                    <a href="{% url 'ForgetPassword' %}" class="card-link col-lg-4 text-decoration-none">
                        <div class="glass-btn-card text-center p-3">
                            <i class="fa-solid fa-user-lock"></i><br>
                            <span class="fw-bold">Change Password</span>
                        </div>
                    </a>

                </div>
            </div>
        </div>
<!-- -----------------------------Recent Activity-------------------------------- -->
        <div class="col-lg-4">
            <div class="glass-card p-4 h-100">
                <h3 class="h5 mb-3">Recent Activity</h3>
                <div id="left" class="transaction-list">
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}
{% block js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('statement/')
            .then(response => response.json())
            .then(statements => {
                console.log("data", statements)
                let count = 1
                statements.forEach(Element => {
                    const colorClass = Element.cash < 0 ? 'text-danger' : 'text-success';
                    const symbol = Element.cash > 0 ? '+' : '';
                    const Div = document.createElement('div')
                    Div.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center rounded p-2 mb-1 statement">
                            <div>
                                <div class="small opacity-75">${Element.detail}</div>
                                <div class="fw-bold">Bal: ₹${Element.balance}</div>
                            </div>
                            <div class="h5 mb-0 ${colorClass}">
                                ${symbol}${Element.cash}
                            </div>
                        </div>
                    `;

                    document.querySelector("#left").appendChild(Div)
                    count++
                });
            })

        document.querySelector("#close").addEventListener("click", () => {
            fetch("{% url 'LoginApp:hide_balance' %}")
            window.location.reload();
        })
    })

</script>
{% endblock %}